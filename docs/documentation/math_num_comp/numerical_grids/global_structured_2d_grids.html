<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexander Smolka">
<meta name="dcterms.date" content="2023-07-07">

<title>ExESS - 2.2.1 – Global Structured Two-Dimensional Grids</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../..//resources/logo/exess_logo.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
    MathJax = { 
        tex: { 
            tags: 'ams'  // should be 'ams', 'none', or 'all' 
        }
    };
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            extensions: ["mhchem.js", "siunitx.js"]
          }
      });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../resources/logo/exess_logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">ExESS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../documentation/documentation.html" rel="" target="" aria-current="page">
 <span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../src/wiki.html" rel="" target="">
 <span class="menu-text">Wiki</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../src/manual.html" rel="" target="">
 <span class="menu-text">Manual</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../api/api.html" rel="" target="">
 <span class="menu-text">API</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../documentation/math_num_comp.html">2 - Mathematics, Numerics, and Computational Foundations</a></li><li class="breadcrumb-item"><a href="../../../documentation/math_num_comp/numerical_grids.html">2.2 - Numerical Grids</a></li><li class="breadcrumb-item"><a href="../../../documentation/math_num_comp/numerical_grids/global_structured_2d_grids.html">2.2.1 – Global Structured Two-Dimensional Grids</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Documentation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 - Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../documentation/math_num_comp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 - Mathematics, Numerics, and Computational Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../documentation/math_num_comp/coordinate_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 - Coordinate Systems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/math_num_comp/coordinate_systems/cartesian_spherical_coordinates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1.1 – Cartesian and Spherical Coordinates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/math_num_comp/coordinate_systems/spacial_differentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1.2 – Spacial Differentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/math_num_comp/coordinate_systems/temporal_differentials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1.3 – Temporal Differentials</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../documentation/math_num_comp/numerical_grids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.2 - Numerical Grids</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../documentation/math_num_comp/numerical_grids/global_structured_2d_grids.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2.2.1 – Global Structured Two-Dimensional Grids</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2.2.1 – Global Structured Two-Dimensional Grids</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alexander Smolka </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<!-- SIUNITX WORKAROUND -->
<hr>
<p>The global, structured, two-dimensional grid is discretizing the surface of a perfectly spherical body of fixed radius <span class="math inline">\(r\)</span> using a regular, structured grid with a fixed angular resolution <span class="math inline">\(\Delta\vartheta\times \Delta\varphi\)</span>, in azimuth and elevation direction, respectively. Since the definition includes spherical elements, the grid is created in global spherical coordinates <span class="math inline">\(\boldsymbol{\mathbf{r}}= \left[r, \vartheta, \varphi\right]^T\)</span>, see <a href="../../../documentation/math_num_comp/coordinate_systems/cartesian_spherical_coordinates.html">2.1.1 – Cartesian and Spherical Coordinates</a>.</p>
<p>The spherical coordinates, the azimuth <span class="math inline">\(\vartheta\)</span> and elevation <span class="math inline">\(\varphi\)</span>, are created as follows: <span class="math display">\[\begin{alignat}{4}
    \vartheta_i &amp;= - \pi + \frac{\pi}{N_\vartheta} + (i-1)\Delta\vartheta&amp; \quad\text{for } i \in \{1, \dots, N_\vartheta\} &amp; \quad\text{with } \Delta\vartheta= \frac{2\pi}{N_\vartheta} \label{eq:gs2dgrid_azimuth} \\
    \varphi_j &amp;= - \frac{\pi}{2} + \frac{\pi}{2N_\varphi} + (j-1)\Delta\varphi&amp; \quad\text{for } j \in \{1, \dots, N_\varphi\} &amp; \quad\text{with } \Delta\varphi= \frac{\pi}{N_\varphi} \label{eq:gs2dgrid_elevation}
\end{alignat}\]</span> where <span class="math inline">\(N_\vartheta\)</span> and <span class="math inline">\(N_\varphi\)</span> define the number of elements in the azimuth and elevation direction, respectively. The created points of the grid are located in the center of each rectangular grid cell, i.e., at <span class="math inline">\(\Delta\vartheta/ 2 = \pi /N_\vartheta\)</span> and <span class="math inline">\(\Delta\varphi/ 2 = \pi / \left(2N_\varphi\right)\)</span> of each elements sides. Let <span class="math inline">\(k\)</span> be a common index with <span class="math inline">\(k = (i-1)N_\varphi+ j\)</span>, then every grid element’s coordinate can be written as <span class="math inline">\(\boldsymbol{\mathbf{r}}_k = \left(r, \vartheta_i, \varphi_j\right)\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Azimuth Periodicity
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Due to the <span class="math inline">\(2\pi\)</span>-periodicity of the azimuth angle <span class="math inline">\(\vartheta\)</span>, the structure, which is the constant <span class="math inline">\(\Delta\vartheta\)</span> angular distance between elements, has to be shown across its periodic boundaries: <span class="math display">\[\begin{align*}
    \vartheta_1 + 2\pi - \vartheta_{N_\vartheta} &amp;= \left(- \pi + \frac{\pi}{N_\vartheta}\right) + 2\pi - \left(- \pi + \frac{\pi}{N_\vartheta} + (N_\vartheta-1)\frac{2\pi}{N_\vartheta} \right) = \frac{2\pi}{N_\vartheta} = \Delta\vartheta
\end{align*}\]</span></p>
</div>
</div>
</div>
<p>With the same index notation, the area of each spherical grid element can be calculated as the integral over its angles at each angular position: <span class="math display">\[\begin{align}
    A_k &amp;= \int_{\vartheta_i-\frac{\Delta\vartheta}{2}}^{\vartheta_i+\frac{\Delta\vartheta}{2}} \int_{\varphi_j-\frac{\Delta\varphi}{2}}^{\varphi_j+\frac{\Delta\varphi}{2}} r^2 \cos \left( \varphi\right) d\varphi d\vartheta\\
    \Rightarrow\qquad A_k &amp;= r^2 \cdot \Delta\vartheta\cdot \left(\sin\left(\varphi_j + \frac{\Delta\varphi}{2}\right) - \sin\left(\varphi_j - \frac{\Delta\varphi}{2}\right)\right).
    \label{eq:area_gs2dgrid}
\end{align}\]</span> Note that the definition for the area is independent of the azimuth angle <span class="math inline">\(\vartheta\)</span>, thus equal across all <span class="math inline">\(N_\vartheta\)</span> elements in the azimuth direction.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Figure</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Julia</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">LaTeX</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div id="fig-gs2dgrid" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../../../img/documentation/math_num_comp/numerical_grids/gs2dgrid/gs2dgrid.svg" class="img-fluid figure-img" style="width:95.0%"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Global, structured, two-dimensional numerical grid in cartesian (lower right) and spherical (center and upper left) coordinates in arbitrary units. Arrows indicate the projection from the spherical to the cartesian coordinate system and vice versa. Note that the grid is only two-dimensional in the spherical coordinate system, assuming a constant third-dimension, i.e.&nbsp;radius <span class="math inline">\(r\)</span>.</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">.ExESS</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span>, <span class="bu">GeoMakie</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::. functions</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gs2dgrid_2d</span>(N_theta<span class="op">=</span><span class="fl">20</span>, N_phi<span class="op">=</span><span class="fl">10</span>;)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> <span class="fu">GlobalStructured2DGrid</span>(<span class="dt">Float32</span>,<span class="fl">1</span>,N_theta,N_phi)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    Xs <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">vec</span>.(<span class="fu">coords</span>(grid))<span class="ch">'...)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># setup figure</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(;resolution<span class="op">=</span>(<span class="fl">600</span>,<span class="fl">300</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>];</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        xautolimitmargin<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">0</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"Azimuth"</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        yautolimitmargin<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">0</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"Elevation"</span>,)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hidedecorations!</span>(ax; label<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid points</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, <span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">2</span>]), <span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">3</span>]), markersize<span class="op">=</span><span class="fl">3</span>, color<span class="op">=:</span>black)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># custom grid lines</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> phi <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">3</span>]))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> phi <span class="op">&lt;</span> <span class="op">-</span><span class="fl">85</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, [<span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>], [phi, phi] <span class="op">.-</span> <span class="fl">90</span><span class="op">/</span>N_phi; color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> theta <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">2</span>]))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> theta <span class="op">&lt;</span> <span class="op">-</span><span class="fl">170</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, <span class="fu">ones</span>(<span class="fl">100</span>)<span class="op">*</span>theta <span class="op">.-</span> <span class="fl">180</span><span class="op">/</span>N_theta, <span class="fu">range</span>(<span class="op">-</span><span class="fl">90</span>,<span class="fl">90</span>,<span class="fl">100</span>); color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save figure</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_2d.pdf"</span>), fig)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_2d.svg"</span>), fig)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_2d.png"</span>), fig, px_per_unit<span class="op">=</span><span class="fl">4</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="cn">nothing</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gs2dgrid_proj</span>(N_theta<span class="op">=</span><span class="fl">20</span>, N_phi<span class="op">=</span><span class="fl">10</span>;)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> <span class="fu">GlobalStructured2DGrid</span>(<span class="dt">Float32</span>,<span class="fl">1</span>,N_theta,N_phi)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    Xs <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">vec</span>.(<span class="fu">coords</span>(grid))<span class="ch">'...)</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># setup figure</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(;resolution<span class="op">=</span>(<span class="fl">600</span>,<span class="fl">300</span>))</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">MyLTGeoAxis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>]; </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"Azimuth"</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        xticks<span class="op">=</span>[<span class="fl">0</span>],</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"Elevation"</span>,) </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hidedecorations!</span>(ax; label<span class="op">=</span><span class="cn">false</span>);</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid points</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, <span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">2</span>]), <span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">3</span>]), markersize<span class="op">=</span><span class="fl">3</span>, color<span class="op">=:</span>black)</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># custom grid lines</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> phi <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">3</span>]))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> phi <span class="op">&lt;</span> <span class="op">-</span><span class="fl">85</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, [<span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>], [phi, phi] <span class="op">.-</span> <span class="fl">90</span><span class="op">/</span>N_phi; color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> theta <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">2</span>]))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> theta <span class="op">&lt;</span> <span class="op">-</span><span class="fl">170</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, <span class="fu">ones</span>(<span class="fl">100</span>)<span class="op">*</span>theta <span class="op">.-</span> <span class="fl">180</span><span class="op">/</span>N_theta, <span class="fu">range</span>(<span class="op">-</span><span class="fl">90</span>,<span class="fl">90</span>,<span class="fl">100</span>); color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save figure</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_proj.pdf"</span>), fig)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_proj.svg"</span>), fig)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_proj.png"</span>), fig, px_per_unit<span class="op">=</span><span class="fl">4</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="cn">nothing</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">gs2dgrid_3d</span>(N_theta<span class="op">=</span><span class="fl">20</span>, N_phi<span class="op">=</span><span class="fl">10</span>;)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> <span class="fu">GlobalStructured2DGrid</span>(<span class="dt">Float32</span>,<span class="fl">1</span>,N_theta,N_phi)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    Xs <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">vec</span>.(<span class="fu">coords</span>(grid))<span class="ch">'...)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    Xc <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">vec</span>.(<span class="fu">coords</span>(GlobalCartesianPosition, grid))<span class="ch">'...)</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(;resolution<span class="op">=</span>(<span class="fl">400</span>,<span class="fl">400</span>))</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis3</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>];</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        aspect<span class="op">=:</span>data,</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        azimuth<span class="op">=-</span><span class="fl">0.3</span>pi,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        elevation<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        xlabeloffset<span class="op">=</span><span class="fl">0</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        ylabeloffset<span class="op">=</span><span class="fl">0</span>,</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        zlabeloffset<span class="op">=</span><span class="fl">0</span>,)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hidedecorations!</span>(ax; label<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    x, y, z <span class="op">=</span> <span class="dt">Float64</span>[], <span class="dt">Float64</span>[], <span class="dt">Float64</span>[]</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(Xc[<span class="op">:</span>,<span class="fl">1</span>])</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> Xc[i,<span class="fl">1</span>] <span class="op">&lt;</span> <span class="fl">0</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(x, Xc[i,<span class="fl">1</span>])</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(y, Xc[i,<span class="fl">2</span>])</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(z, Xc[i,<span class="fl">3</span>])</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, x, y, z, markersize<span class="op">=</span><span class="fl">4</span>, color<span class="op">=:</span>black)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># custom grid lines</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> phi <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">3</span>]))</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        phi <span class="op">-=</span> <span class="fl">90</span><span class="op">/</span>N_phi</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> [<span class="fu">cosd</span>(phi) <span class="op">*</span> <span class="fu">cos</span>(x) for x <span class="kw">in</span> <span class="fu">range</span>(<span class="op">-</span><span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">100</span>)]</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> [<span class="fu">cosd</span>(phi) <span class="op">*</span> <span class="fu">sin</span>(x) for x <span class="kw">in</span> <span class="fu">range</span>(<span class="op">-</span><span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">100</span>)]</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> [<span class="fu">sind</span>(phi) <span class="op">*</span> <span class="fu">ones</span>(<span class="fl">100</span>)<span class="op">...</span>]</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, x, y, z; color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> theta <span class="kw">in</span> <span class="fu">unique</span>(<span class="fu">rad2deg</span>.(Xs[<span class="op">:</span>,<span class="fl">2</span>]))</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fu">abs</span>(theta) <span class="op">&gt;=</span> <span class="fl">90</span>; <span class="cf">continue</span>; <span class="cf">end</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        theta <span class="op">-=</span> <span class="fl">180</span><span class="op">/</span>N_theta</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> [<span class="fu">cosd</span>(theta) <span class="op">*</span> <span class="fu">cos</span>(x) for x <span class="kw">in</span> <span class="fu">range</span>(<span class="op">-</span><span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">100</span>)]</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> [<span class="fu">sind</span>(theta) <span class="op">*</span> <span class="fu">cos</span>(x) for x <span class="kw">in</span> <span class="fu">range</span>(<span class="op">-</span><span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">100</span>)]</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> [<span class="fu">sin</span>(x) for x <span class="kw">in</span> <span class="fu">range</span>(<span class="op">-</span><span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="cn">pi</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">100</span>)]</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, x, y, z; color<span class="op">=</span>(<span class="op">:</span>black, <span class="fl">0.3</span>), linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save figure</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_3d.pdf"</span>), fig)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_3d.svg"</span>), fig)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">save</span>(<span class="fu">joinpath</span>(<span class="pp">@__DIR__</span>, <span class="st">"gs2dgrid_3d.png"</span>), fig, px_per_unit<span class="op">=</span><span class="fl">4</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="cn">nothing</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="co">#::. call all functions</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">run_all</span>()</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gs2dgrid_2d</span>(<span class="fl">20</span>,<span class="fl">10</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gs2dgrid_proj</span>(<span class="fl">20</span>,<span class="fl">10</span>)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gs2dgrid_3d</span>(<span class="fl">20</span>,<span class="fl">10</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\pgfdeclarelayer</span>{background layer}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\pgfdeclarelayer</span>{foreground layer}</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\pgfsetlayers</span>{background layer,main,foreground layer}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\node</span> (2d) at (0,0) {<span class="bu">\includegraphics</span>[natwidth=600px, natheight=300px]{<span class="ex">./gs2dgrid_2d.pdf</span>}};</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\node</span>[below right = -2 and -14 of 2d] (proj) {<span class="bu">\includegraphics</span>[natwidth=600px, natheight=300px]{<span class="ex">./gs2dgrid_proj.pdf</span>}};</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">\begin</span>{<span class="ex">pgfonlayer</span>}{background layer}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">\node</span>[below right = -5.5 and -10 of proj] (3d) {<span class="bu">\includegraphics</span>[natwidth=400px, natheight=400px, trim={0 30pt 0 0}, clip]{<span class="ex">./gs2dgrid_3d.pdf</span>}};</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">\end</span>{<span class="ex">pgfonlayer</span>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\draw</span>[-latex, very thick] (<span class="ss">$(3d.90)+(0,-3)$</span>) to [in=0, out=90] node[near end, above, yshift=40px]{<span class="fu">\LARGE</span>{spherical projection}} (<span class="ss">$(2d.0)+(-4,0)$</span>) ;</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">\draw</span>[-latex, very thick] (2d.220) to [in=180, out=270] node[near end, below, yshift=-30px]{<span class="fu">\LARGE</span>{cartesian projection}} (3d.190) ;</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><a href="#fig-gs2dgrid">Figure&nbsp;1</a> shows an example of a spherical surface discretization based on the global, structured, two-dimensional grid. Elements were created based on Eqs. <span class="math inline">\(\eqref{eq:gs2dgrid_azimuth}\)</span>, <span class="math inline">\(\eqref{eq:gs2dgrid_elevation}\)</span> with <span class="math inline">\(N_\vartheta= 20\)</span> elements in azimuth and <span class="math inline">\(N_\varphi= 10\)</span> elements in elevation, leading to a total of <span class="math inline">\(200\)</span> grid elements and, thus, coordinates <span class="math inline">\(\boldsymbol{\mathbf{r}}_k\)</span> for <span class="math inline">\(k\in\{1,\dots,200\}\)</span>. The grid resolution is <span class="math inline">\(\Delta\vartheta\times\Delta\varphi= 18\,\mathrm{\degree}\times18\,\mathrm{\degree}\)</span>. The figure shows three different views of the same numerical discretization. The top left in a conventional axis making use of the two-dimensionality of the grid, with the azimuth angle <span class="math inline">\(\vartheta\)</span> on the horizontal axis and the elevation angle <span class="math inline">\(\varphi\)</span> on the vertical axis. This view highlights the structured nature of the discretization scheme with equally resolved angular elements across the entire domain. The centered graph is a projected view of the spherical coordinates, visualized on a flattened spherical surface based on a projection method . While this flattened surface is neither a conformal nor an equal-area projection of an actual sphere, it provides a good and easily understandable visual representation of the spherical nature of the grid. The structure of the discretization scheme is still visible, while the accumulation of grid elements in the polar region becomes apparent. This accumulation is a direct result of the spherical nature of the grid, where the same angular resolution <span class="math inline">\(\Delta\vartheta\times\Delta\varphi\)</span> leads to a smaller area of the grid elements in the polar region. The bottom right graph depicts the same discretization scheme in a conventional, cartesian coordinate system, which shows the grid in its physical, three-dimensional form, where the polar grid elements are undistorted. Note that this last representation of the grid only shows half of the sphere (<span class="math inline">\(x&gt; 0\)</span>) since the other half is identical due to the symmetry of the spherical coordinate system.</p>
<p>The transformation from one of the visualizations to another is termed either a or a in <a href="#fig-gs2dgrid">Figure&nbsp;1</a>, depending on the type of coordinate system of the destination. The compilation of the three shown views helps to understand both the structural nature of the grid and the general downside of using such a simple discretization scheme, i.e., the clumping of elements around the poles. As already apparent from the area calculation seen in Eq. <span class="math inline">\(\eqref{eq:area_gs2dgrid}\)</span>, the surface coverage of each element on the same elevation is equal, while it decreases with <span class="math inline">\(\sin\varphi\rightarrow 0\)</span> towards the poles.</p>
<p>In many applications of numerical grids, it is necessary to map coordinates in the continuous domain to the discrete grid points, i.e., to find the grid element the continuous coordinate is located in. For the structural grid, the problem can be defined in terms of the shared index <span class="math inline">\(k\)</span> as <span class="math inline">\(\boldsymbol{\mathbf{r}}\mapsto \boldsymbol{\mathbf{r}}_k = \left[r, \vartheta_k, \varphi_k\right]^T\)</span>, or in terms of the individual indices <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> as <span class="math inline">\(\boldsymbol{\mathbf{r}}\mapsto \left[r, \vartheta_i, \varphi_j\right]\)</span> with <span class="math inline">\(k = (i-1)N_\varphi+ j\)</span>. The latter approach can be analytically solved for the azimuth and elevation indices using the function, <span class="math inline">\(\lceil\bullet\rceil\)</span>, to round the floating-point calculations to the next higher integer index: <span class="math display">\[\begin{align}
    i &amp;= \left\lceil \frac{\left(\vartheta+\pi\right)N_\vartheta}{2\pi} \right\rceil = \left\lceil \frac{\vartheta+\pi}{\Delta\vartheta} \right\rceil, \label{eq:gs2dgrid_coord2idx_azimuth}\\
    j &amp;= \left\lceil \frac{\left(\varphi+\pi/2\right)N_\varphi}{\pi} \right\rceil = \left\lceil \frac{\varphi+\pi/2}{\Delta\varphi} \right\rceil. \label{eq:gs2dgrid_coord2idx_elevation}
\end{align}\]</span> Numerical problems can arise around the boundaries of the numerical grid due to <span class="math inline">\(\lceil 0 \rceil = 0\)</span>. As no zeroth grid element exists, the inputs must be pretreated to avoid this problem. For the azimuth angle, the angle is mapped to the half-open interval <span class="math inline">\(\left(-\pi, \pi\right]\)</span>, thus if <span class="math inline">\(\vartheta=-\pi\)</span> then <span class="math inline">\(\vartheta\mapsto \vartheta+ 2\pi\)</span>. The elevation is mapped to the open interval <span class="math inline">\(\left(-\pi/2, \pi/2\right)\)</span> and should <span class="math inline">\(|\varphi| = \pi/2\)</span> then <span class="math inline">\(\varphi\mapsto \varphi- \mathop{\mathrm{sgn}}\left(\varphi\right)\epsilon\)</span>, with the machine accuracy <span class="math inline">\(\epsilon\)</span> being the smallest floating point number available to the machine.</p>
<p>For some applications, equatorial symmetry of the underlying problem can be assumed, which can be exploited to reduce the number of grid elements. In this case, the grid is only defined for <span class="math inline">\(\varphi\in \left[0, \pi/2\right)\)</span>, and the elevation is subsequently calculated similar to Eq. <span class="math inline">\(\eqref{eq:gs2dgrid_elevation}\)</span>: <span class="math display">\[\begin{equation}
    \varphi_j = \frac{\pi}{4N_\varphi} + (j-1)\Delta\varphi\quad\text{for } j \in \{1, \dots, N_\varphi\}  \quad\text{with}\quad \Delta\varphi= \frac{\pi}{2N_\varphi}
    \label{eq:gs2dgrid_eqsim_elevation}
\end{equation}\]</span> This also changes the function mapping continuous coordinates to specific and discrete grid elements; see Eq. <span class="math inline">\(\eqref{eq:gs2dgrid_coord2idx_elevation}\)</span>: <span class="math display">\[\begin{equation}
    j = \left\lceil \frac{\left|\varphi\right| \cdot N_\varphi}{\pi/2} \right\rceil = \left\lceil \frac{\varphi+\pi/2}{\Delta\varphi} \right\rceil.
    \label{eq:gs2dgrid_eqsim_coord2idx_elevation}
\end{equation}\]</span> Taking the absolute value of the elevation angle in the equation above ensures that the function is defined for the entire sphere. Still, the mapping always projects the coordinate onto the upper hemisphere.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ExESS API – Two-Dimensional Global Structured Grids
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><a href="../../../api/grids/global_structured_2d_grids.html"><code>GlobalStructuredGrid</code></a>: global, structured grids, see Eqs. <span class="math inline">\(\eqref{eq:gs2dgrid_azimuth}\)</span> – <span class="math inline">\(\eqref{eq:gs2dgrid_coord2idx_elevation}\)</span></li>
<li><a href="../../../api/grids/global_structured_2d_grids.html"><code>GlobalStructuredGrid_EqSim</code></a>: global, structured, equatorially symmetric grids, additionally see Eqs. <span class="math inline">\(\eqref{eq:gs2dgrid_eqsim_elevation}\)</span> – <span class="math inline">\(\eqref{eq:gs2dgrid_eqsim_coord2idx_elevation}\)</span></li>
</ul>
<p><strong>Utility functions</strong>:</p>
<ul>
<li><a href="../../../api/grids/utility.html"><code>areas</code></a>: Eq. <span class="math inline">\(\eqref{eq:area_gs2dgrid}\)</span></li>
<li><a href="../../../api/grids/utility.html"><code>coords</code></a>: Eqs. <span class="math inline">\(\eqref{eq:gs2dgrid_azimuth}\)</span>, <span class="math inline">\(\eqref{eq:gs2dgrid_elevation}\)</span>, and <span class="math inline">\(\eqref{eq:gs2dgrid_eqsim_elevation}\)</span></li>
<li><a href="../../../api/grids/utility.html"><code>coord2idx</code></a>: Eqs. <span class="math inline">\(\eqref{eq:gs2dgrid_coord2idx_azimuth}\)</span>, <span class="math inline">\(\eqref{eq:gs2dgrid_coord2idx_elevation}\)</span>, and <span class="math inline">\(\eqref{eq:gs2dgrid_eqsim_coord2idx_elevation}\)</span></li>
<li><a href="../../../api/grids/utility.html"><code>surfacecoords</code></a>: identical to <code>coords</code></li>
<li><a href="../../../api/grids/utility.html"><code>volumes</code></a>: zero, since only two-dimensions</li>
</ul>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>