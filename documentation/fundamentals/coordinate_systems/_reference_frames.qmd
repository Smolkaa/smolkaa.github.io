Since this work involves several different scales, from nano to planetary, and processes a variety of algorithms, naturally, it requires varying reference frames for its calculations, each fitting for the respective task at hand. This section provides an overview of the relevant reference frames and their transformations. The main two categories are global reference frames, which are indicated by the prescript $\global\bullet$, and local reference frames, which are indicated by the prescript $\local\bullet$. 


## Global Reference Frames
Global reference frames are used for calculations on a planetary scale, thus providing a coordinate system based on a planetary body, like the Moon. 

Moon -> selenocentric

Earth -> geocentric

Sun -> heliocentric

If not specified otherwise, all global coordinate systems are subsolar coordinate systems, meaning that the orientation of their base vectors is based on the Sun's position. The category can be further divided into two subcategories based on their respective type of coordinates: Cartesian and spherical.

### Global Cartesian Coordinate Systems
Positional vectors of the global cartesian coordinate system are defined as
\begin{equation}
    \global\cartesianCoordinate = \begin{bmatrix}
        \global\cartesianCoordinateX \\ 
        \global\cartesianCoordinateY \\ 
        \global\cartesianCoordinateZ 
    \end{bmatrix} \qquad\text{with } \global\cartesianCoordinateX\in\Set{R},\;\global\cartesianCoordinateY\in\Set{R},\;\global\cartesianCoordinateZ\in\Set{R},
\end{equation}
while velocities are defined as their first temporal derivative, and since all global base vectors $\baseVector_i$ are time-invariant, it resolves to
\begin{align}
    \global\dot{\cartesianCoordinate} = \frac{d}{d\Time} \left( \global\cartesianCoordinate \right) &= \frac{d}{d\Time} \left( \global\cartesianCoordinateX \cartesianBaseVectorX + \global\cartesianCoordinateY \cartesianBaseVectorY + \global\cartesianCoordinateZ \cartesianBaseVectorZ \right) = \global\dot\cartesianCoordinateX \cartesianBaseVectorX + \global\dot\cartesianCoordinateY \cartesianBaseVectorY + \global\dot\cartesianCoordinateZ \cartesianBaseVectorZ = \begin{bmatrix}
        \global\dot\cartesianCoordinateX \\ 
        \global\dot\cartesianCoordinateY \\ 
        \global\dot\cartesianCoordinateZ 
    \end{bmatrix}
    \\ & \text{with } \global\dot\cartesianCoordinateX\in\Set{R},\;\global\dot\cartesianCoordinateY\in\Set{R},\;\global\dot\cartesianCoordinateZ\in\Set{R}. \label{eq:global_cartesian_velocity} \nonumber
\end{align}

The coordinate system is fixed in place, with its origin at the center of the planetary body, and its base vectors pointing in the direction of the planetary axes, shown in @fig-global_cartesian. The base vectors are defined as $\cartesianBaseVectorX$ pointing towards the Sun, $\cartesianBaseVectorY$ pointing towards positive longitude (east), and $\cartesianBaseVectorZ$ pointing towards positive latitude (north). The base vectors are orthogonal to each other. Note that in the figure below, the global subscript was omitted for the simplicity of the visualization.

{{< include coordinate_systems/imgs/reference_frames/_global_cartesian.qmd >}}

### Global Spherical Coordinate Systems

## Local Reference Frames
Local reference frames are used for calculations on a smaller scale. One example is the calculation of thermal desorption velocities (see [Thermal Sorption](/documentation/drivers/thermal_sorption.qmd)), which only depends on the local surface temperature.

### Local Cartesian Coordinate Systems

### Local Spherical Coordinate Systems


## Transformations

Often it is useful to describe one problem in a different reference frame than another, requiring a transformation between the two.


### To Global Cartesian Positions

Let $\sphericalCoordinate = \sphericalCoordinateDef$ be a global spherical position vector given in spherical elements. The transformation to a global cartesian position vector $\cartesianCoordinate = \cartesianCoordinateDef$ is identical to the transformation presented in Eq. \eqref{eq:cartesian_coordinate_spherical_elements}:
\begin{equation}
    \cartesianCoordinate = \begin{bmatrix}
        \sphericalCoordinateRadius \cos\sphericalCoordinateAzimuth \cos\sphericalCoordinateElevation \\ 
        \sphericalCoordinateRadius \sin\sphericalCoordinateAzimuth \cos\sphericalCoordinateElevation \\ 
        \sphericalCoordinateRadius \sin\sphericalCoordinateElevation 
    \end{bmatrix} = \begin{bmatrix}
        \cartesianCoordinateX \\ 
        \cartesianCoordinateY \\ 
        \cartesianCoordinateZ 
    \end{bmatrix}
\end{equation}
with $\sphericalCoordinateRadius\in\Set{R}^+,\;\sphericalCoordinateAzimuth\in\left[-\pi,\pi\right),\;\sphericalCoordinateElevation\in\left[-\frac{\pi}{2},\frac{\pi}{2}\right]$.


### To Global Spherical Positions

Let $\cartesianCoordinate = \cartesianCoordinateDef$ be a global cartesian position vector given in cartesian elements. The transformation to a global spherical position vector $\sphericalCoordinate = \sphericalCoordinateDef$ is identical to the transformation presented in Eq. \eqref{eq:spherical_coordinate_cartesian_elements}:
\begin{equation}
    \sphericalCoordinate = \begin{bmatrix}
        \sqrt{\cartesianCoordinateX^2 + \cartesianCoordinateY^2 + \cartesianCoordinateZ^2} \\ 
        \sgn\left(\cartesianCoordinateY\right)\cdot\cos^{-1}\left(\frac{\cartesianCoordinateX}{\sqrt{\cartesianCoordinateX^2 + \cartesianCoordinateY^2}}\right)\\
        \sin^{-1}\left(\frac{\cartesianCoordinateZ}{\sqrt{\cartesianCoordinateX^2 + \cartesianCoordinateY^2 + \cartesianCoordinateZ^2}}\right) 
    \end{bmatrix}
\end{equation}
with $\cartesianCoordinateX\in\Set{R},\;\cartesianCoordinateY\in\Set{R},\;\cartesianCoordinateZ\in\Set{R}.$


### To Global Cartesian Velocities

Let $\local\vec\velocity = \left[\velocity_\cartesianCoordinateX, \velocity_\cartesianCoordinateY, \velocity_\cartesianCoordinateZ\right]^T$ be a local cartesian velocity vector given in cartesian elements, and $\sphericalCoordinate = \sphericalCoordinateDef$ be a global spherical position vector given in spherical elements. The transformation to a global cartesian velocity vector $\dot{\cartesianCoordinate} = \left[\dot\cartesianCoordinateX, \dot\cartesianCoordinateY, \dot\cartesianCoordinateZ\right]^T$ is given by
\begin{equation}
    \global\dot{\cartesianCoordinate} = \begin{bmatrix}
        -\velocity_\cartesianCoordinateX \sin\sphericalCoordinateAzimuth - \velocity_\cartesianCoordinateY \cos\sphericalCoordinateAzimuth \sin\sphericalCoordinateElevation + \velocity_\cartesianCoordinateZ \cos\sphericalCoordinateAzimuth \cos\sphericalCoordinateElevation \\
        \velocity_\cartesianCoordinateX \cos\sphericalCoordinateAzimuth - \velocity_\cartesianCoordinateY \sin\sphericalCoordinateAzimuth \sin\sphericalCoordinateElevation + \velocity_\cartesianCoordinateZ \sin\sphericalCoordinateAzimuth \cos\sphericalCoordinateElevation \\
        \velocity_\cartesianCoordinateY \cos\sphericalCoordinateElevation + \velocity_\cartesianCoordinateZ \sin\sphericalCoordinateElevation
    \end{bmatrix}
\end{equation}
with $\velocity_\cartesianCoordinateX\in\Set{R},\;\velocity_\cartesianCoordinateY\in\Set{R},\;\velocity_\cartesianCoordinateZ\in\Set{R}$ and $\sphericalCoordinateRadius\in\Set{R}^+,\;\sphericalCoordinateAzimuth\in\left[-\pi,\pi\right),\;\sphericalCoordinateElevation\in\left[-\frac{\pi}{2},\frac{\pi}{2}\right]$.


### To Global Spherical Velocities

### To Local Cartesian Positions

### To Local Cartesian Velocities

